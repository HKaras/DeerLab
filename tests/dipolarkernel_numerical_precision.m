function [err,data,maxerr] = test(opt,olddata)

%Diagonal of the kernel computed by Mathematica
AnalyticalK = [1.0000000000,0.989724398140451,0.962515792044324,...
                0.923357314598256,0.876467881653175,0.825234082935656,...
                0.772254178654206,0.7194382916615353,0.6681283832861617,...
                0.6192166540804442,0.5732514365483727,0.5305262588065542,...
                0.4911515927620221,0.4551107805249435,0.4223024633121614,...
                0.392572008388934,0.36573425944988,0.341589617501408,...
                0.3199351024441117,0.3005717069668208,0.2833090592292863,...
                0.267968166522219,0.254382816849717,0.2424000632480482,...
                0.2318800993988875,0.2226957476286343,0.2147317154350837,...
                0.2078837290058122,0.2020576175693561,0.1971683975415496,...
                0.1931393877500987,0.189901374611529,0.1873918375511382,...
                0.1855542391265816,0.1843373804504827,0.1836948200309367,...
                0.1835843526431566,0.183967544009507,0.1848093166834957,...
                0.1860775824526887,0.1877429166883227,0.1897782703003589,...
                0.1921587152541385,0.1948612199336216,0.1978644509731252,...
                0.20114859850965,0.2046952221220808,0.2084871150166276,...
                0.2125081842872863,0.2167433453252193,0.2211784286720325,...
                0.2258000978103631,0.2305957765621875,0.2355535849228373,...
                0.2406622822984046,0.2459112172379939,0.2512902828615692,...
                0.2567898772807469,0.2624008683950047,0.2681145625208937,...
                0.2739226763779486,0.2798173120132994,0.2857909342982663,...
                0.2918363506754233,0.2979466928743729,0.3041154003494873,...
                0.3103362052236684,0.316603118549307,0.3229104177214331,...
                0.3292526348990539,0.3356245463090749,0.3420211623234172,...
                0.3484377182141593,0.3548696655040118,0.3613126638403911,...
                0.3677625733309205,0.3742154472866299,0.3806675253264258,...
                0.3871152268028285,0.3935551445145768,0.3999840386765473,...
                0.4063988311216874,0.4127965997133177,0.4191745729493571,...
                0.4255301247427376,0.4318607693646827,0.4381641565395229,...
                0.4444380666814714,0.4506804062652827,0.4568892033239461,...
                0.4630626030676741,0.469198863619311,0.4752963518620538,...
                0.4813535393960072,0.4873689986006013,0.493341398800322,...
                0.4992695025315693,0.5051521619086755,0.5109883150874113,...
                0.5167769828243905,0.5225172651309626];

%Generate kernel numerically      
t = linspace(0,8*(length(AnalyticalK)-1),length(AnalyticalK));
r = linspace(2.5,6,length(t));

K = dipolarkernel(t,r);
K = K/mean(diff(r));

NumericalK = diag(K);

%Check the precision
err = any(abs(NumericalK' - AnalyticalK)>1e-14);
maxerr = max(abs(NumericalK' - AnalyticalK));
data = [];

if opt.Display
figure(1213),clf
plot(AnalyticalK)
hold on
plot(NumericalK)
end



end
