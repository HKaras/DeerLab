

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>fitmultimodel &mdash; DeerLab  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="/source/_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="/source/_static/theme_override.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/table_util.css" type="text/css" />
  <link rel="stylesheet" href="../_static/table_main.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_override.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-dataframe.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="fitparamodel" href="fitparamodel.html" />
    <link rel="prev" title="backgroundstart" href="backgroundstart.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation instructions</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firstscript.html">A first script</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics.html">Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preprocess.html">Loading and preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fitting.html">Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uncertainty.html">Uncertainty</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../functions.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modelsref.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../theory.html">Theory</a></li>
</ul>
<p class="caption"><span class="caption-text">Others</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../funding.html">Funding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DeerLab</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../functions.html">Functions</a> &raquo;</li>
        
      <li><code class="xref py py-mod docutils literal notranslate"><span class="pre">fitmultimodel</span></code></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="fitmultimodel">
<span id="id1"></span><h1><code class="xref py py-mod docutils literal notranslate"><span class="pre">fitmultimodel</span></code><a class="headerlink" href="#fitmultimodel" title="Permalink to this headline">¶</a></h1>
<dl class="py function">
<dt id="deerlab.fitmultimodel">
<code class="sig-prename descclassname">deerlab.</code><code class="sig-name descname">fitmultimodel</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">V</span></em>, <em class="sig-param"><span class="n">Kmodel</span></em>, <em class="sig-param"><span class="n">r</span></em>, <em class="sig-param"><span class="n">model</span></em>, <em class="sig-param"><span class="n">maxModels</span></em>, <em class="sig-param"><span class="n">method</span><span class="o">=</span><span class="default_value">'aic'</span></em>, <em class="sig-param"><span class="n">lb</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">ub</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">lbK</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">ubK</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">weights</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">renormalize</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">uqanalysis</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/deerlab/fitmultimodel.html#fitmultimodel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deerlab.fitmultimodel" title="Permalink to this definition">¶</a></dt>
<dd><p>Fits a multi-model parametric distance distribution model to a dipolar signal using separable 
non-linear least-squares (SNLLS).</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl>
<dt><strong>V</strong><span class="classifier">array_like or list of array_like</span></dt><dd><p>Dipolar signal(s) to be fitted.</p>
</dd>
<dt><strong>Kmodel</strong><span class="classifier">callable or 2D-array_like</span></dt><dd><p>Dipolar kernel model. If no kernel parameters must be fitted, it can be specified as a matrix array 
(or a list thereof if multiple signals are globally fitted). 
Otherwise, it is a callable function that accepts an array of kernel parameters and returns
a kernel matrix array or a list thereof.</p>
</dd>
<dt><strong>r</strong><span class="classifier">array_like</span></dt><dd><p>Distance axis, in nanometers.</p>
</dd>
<dt><strong>model</strong><span class="classifier">callable</span></dt><dd><p>Basis component of the multi-component distance distribution. 
Must be a callable DeerLab model function (e.g. dd_gauss or dd_rice).</p>
</dd>
<dt><strong>maxModels</strong><span class="classifier">scalar</span></dt><dd><p>Maximal number of components in the multi-component distance distribution.</p>
</dd>
<dt><strong>method</strong><span class="classifier">string</span></dt><dd><p>Functional metric used for the selection of the optimal number of components:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'aic'</span></code>  Akaike information criterion</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'aicc'</span></code> corrected Akaike information criterion</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'bic'</span></code>  Bayesian information criterion</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'rmsd'</span></code> Root-mean squared deviation</p></li>
</ul>
<p>The default is <code class="docutils literal notranslate"><span class="pre">'aic'</span></code>.</p>
</dd>
<dt><strong>lb</strong><span class="classifier">array_like</span></dt><dd><p>Lower bounds for the distribution basis model parameters. If not specified, parameters are unbounded.</p>
</dd>
<dt><strong>ub</strong><span class="classifier">array_like</span></dt><dd><p>Upper bounds for the distribution basis model parameters. If not specified, parameters are unbounded.</p>
</dd>
<dt><strong>ubK</strong><span class="classifier">array_like</span></dt><dd><p>Lower bounds for the kernel model parameters. If not specified, parameters are unbounded.</p>
</dd>
<dt><strong>ubK</strong><span class="classifier">array_like</span></dt><dd><p>Upper bounds for the kernel model parameters. If not specified, parameters are unbounded.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl>
<dt><a class="reference internal" href="FitResult.html#fitresult"><span class="std std-ref">FitResult</span></a> with the following fields defined:</dt><dd></dd>
<dt><strong>P</strong><span class="classifier">ndarray</span></dt><dd><p>Fitted distance distribution with optimal number of components.</p>
</dd>
<dt><strong>Pparam</strong><span class="classifier">ndarray</span></dt><dd><p>Fitted distance distribution components parameters</p>
</dd>
<dt><strong>amps</strong><span class="classifier">ndarray</span></dt><dd><p>Fitted components amplitudes</p>
</dd>
<dt><strong>Kparam</strong><span class="classifier">ndarray</span></dt><dd><p>Fitted kernel parameters.</p>
</dd>
<dt><strong>Puncert</strong><span class="classifier"><a class="reference internal" href="UncertQuant.html#uncertquant"><span class="std std-ref">UncertQuant</span></a></span></dt><dd><p>Covariance-based uncertainty quantification of the fitted distance distribution</p>
</dd>
<dt><strong>paramUncert</strong><span class="classifier"><a class="reference internal" href="UncertQuant.html#uncertquant"><span class="std std-ref">UncertQuant</span></a></span></dt><dd><p>Covariance-based uncertainty quantification of the fitted parameters</p>
</dd>
<dt><strong>Nopt</strong><span class="classifier">int scalar</span></dt><dd><p>Optimized number of components in model.</p>
</dd>
<dt><strong>Pn</strong><span class="classifier">list of ndarrays</span></dt><dd><p>List of all fitted multi-component distance distributions.</p>
</dd>
<dt><strong>selfun</strong><span class="classifier">ndarray</span></dt><dd><p>Selection functional values (as specified as <code class="docutils literal notranslate"><span class="pre">method</span></code>) for the all fitted multi-component models.</p>
</dd>
<dt><strong>scale</strong><span class="classifier">float int or list of float int</span></dt><dd><p>Amplitude scale(s) of the dipolar signal(s).</p>
</dd>
<dt><strong>stats</strong><span class="classifier">dict</span></dt><dd><p>Goodness of fit statistical estimators:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">stats['chi2red']</span></code> - Reduced chi^2 test</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stats['r2']</span></code> - R^2 test</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stats['rmsd']</span></code> - Root-mean squared deviation (RMSD)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stats['aic']</span></code> - Akaike information criterion</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stats['aicc']</span></code> - Corrected Akaike information criterion</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stats['bic']</span></code> - Bayesian information criterion</p></li>
</ul>
</dd>
<dt><strong>success</strong><span class="classifier">bool</span></dt><dd><p>Whether or not the optimizer exited successfully.</p>
</dd>
<dt><strong>cost</strong><span class="classifier">float</span></dt><dd><p>Value of the cost function at the solution.</p>
</dd>
<dt><strong>residuals</strong><span class="classifier">ndarray</span></dt><dd><p>Vector of residuals at the solution.</p>
</dd>
</dl>
</dd>
<dt class="field-odd">Other Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>weights</strong><span class="classifier">array_like</span></dt><dd><p>Array of weighting coefficients for the individual signals in global fitting, the default is all weighted equally.</p>
</dd>
<dt><strong>renormalize</strong><span class="classifier">boolean</span></dt><dd><p>Enable/disable renormalization of the fitted distribution, by default it is enabled.</p>
</dd>
<dt><strong>uqanalysis</strong><span class="classifier">boolean</span></dt><dd><p>Enable/disable the uncertainty quantification analysis, by default it is enabled.</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This function takes advantage of the special structure of a multi-component model, i.e. the separability
of the component amplitudes as linear parameters from the rest of the non-linear parameters. This makes it
suitable to be solved as a SNLLS problem.</p>
<p class="rubric">Examples</p>
<p>A classical example involves the fit of a multi-Gauss distance distribution to a 4-pulse DEER dipolar signal. 
Since the signal requires additional parameters  (e.g. modulation depth, background parameters,…) a kernel model
can be defined to account for these:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">K4pdeer</span><span class="p">(</span><span class="n">Kpar</span><span class="p">):</span>
    <span class="c1"># Unpack parameters</span>
    <span class="n">lam</span><span class="p">,</span><span class="n">conc</span> <span class="o">=</span> <span class="n">Kpar</span>
    <span class="c1"># Construct kernel</span>
    <span class="n">K</span> <span class="o">=</span> <span class="nf">dipolarkernel</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">lam</span><span class="p">,</span><span class="nf">bg_hom3d</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">conc</span><span class="p">,</span><span class="n">lam</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">K</span>

<span class="n">fit</span> <span class="o">=</span> <span class="nf">fitmultimodel</span><span class="p">(</span><span class="n">V</span><span class="p">,</span><span class="n">Kmodel</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">dd_model</span><span class="p">,</span><span class="n">Nmax</span><span class="p">,</span><span class="s1">&#39;aicc&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If multiple signals are to be fitted globally the example abova can be easily adapted by passing multiple
signals to the fit function and by returning multiple kernels with the kernel model function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">K4pdeer</span><span class="p">(</span><span class="n">Kpar</span><span class="p">):</span>
    <span class="c1"># Unpack parameters</span>
    <span class="n">lam</span><span class="p">,</span><span class="n">conc</span> <span class="o">=</span> <span class="n">Kpar</span>
    <span class="c1"># Construct kernels for both signals</span>
    <span class="n">K1</span> <span class="o">=</span> <span class="nf">dipolarkernel</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">lam</span><span class="p">,</span><span class="nf">bg_hom3d</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="n">conc</span><span class="p">,</span><span class="n">lam</span><span class="p">))</span>
    <span class="n">K2</span> <span class="o">=</span> <span class="nf">dipolarkernel</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">lam</span><span class="p">,</span><span class="nf">bg_hom3d</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span><span class="n">conc</span><span class="p">,</span><span class="n">lam</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">K1</span><span class="p">,</span><span class="n">K2</span>

<span class="n">fit</span> <span class="o">=</span> <span class="nf">fitmultimodel</span><span class="p">([</span><span class="n">V1</span><span class="p">,</span><span class="n">V2</span><span class="p">],</span><span class="n">Kmodel</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">dd_model</span><span class="p">,</span><span class="n">Nmax</span><span class="p">,</span><span class="s1">&#39;aicc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="fitparamodel.html" class="btn btn-neutral float-right" title="fitparamodel" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="backgroundstart.html" class="btn btn-neutral float-left" title="backgroundstart" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019-2020, Luis Fábregas Ibáñez, Stefan Stoll, and others

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>

  
  
    
   

</body>
</html>