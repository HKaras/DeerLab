

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>fitparamodel &mdash; DeerLab</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="/source/_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="/source/_static/theme_override.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/table_util.css" type="text/css" />
  <link rel="stylesheet" href="../_static/table_main.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_override.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-dataframe.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="fitregmodel" href="fitregmodel.html" />
    <link rel="prev" title="fitmultimodel" href="fitmultimodel.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                v0.12.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics.html">Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginners_guide.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uncertainty.html">Uncertainty</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../functions.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modelsref.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../theory.html">Theory</a></li>
</ul>
<p class="caption"><span class="caption-text">Others</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../funding.html">Funding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Release Notes</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DeerLab</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../functions.html">Functions</a> &raquo;</li>
        
      <li><code class="docutils literal notranslate"><span class="pre">fitparamodel</span></code></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="fitparamodel">
<span id="id1"></span><h1><code class="xref py py-mod docutils literal notranslate"><span class="pre">fitparamodel</span></code><a class="headerlink" href="#fitparamodel" title="Permalink to this headline">¶</a></h1>
<dl class="function">
<dt id="deerlab.fitparamodel">
<code class="descclassname">deerlab.</code><code class="descname">fitparamodel</code><span class="sig-paren">(</span><em>V</em>, <em>model</em>, <em>par0=[]</em>, <em>lb=[]</em>, <em>ub=[]</em>, <em>weights=1</em>, <em>multistart=1</em>, <em>tol=1e-10</em>, <em>maxeval=5000</em>, <em>maxiter=3000</em>, <em>rescale=True</em>, <em>uqanalysis=True</em>, <em>covmatrix=[]</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/deerlab/fitparamodel.html#fitparamodel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#deerlab.fitparamodel" title="Permalink to this definition">¶</a></dt>
<dd><p>Fits the dipolar signal(s) to a parametric model using non-linear least-squares.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><dl class="first docutils">
<dt><strong>V</strong> <span class="classifier-delimiter">:</span> <span class="classifier">array_like or list of array_like</span></dt>
<dd><p class="first last">Dipolar signal(s) to be fitted.</p>
</dd>
<dt><strong>Vmodel</strong> <span class="classifier-delimiter">:</span> <span class="classifier">callable</span></dt>
<dd><p class="first last">Function taking an array of parameters and returning the dipolar signal(s) as an array or a list of arrays.</p>
</dd>
<dt><strong>par0</strong> <span class="classifier-delimiter">:</span> <span class="classifier">array_like</span></dt>
<dd><p class="first last">Start values of the model parameters.</p>
</dd>
<dt><strong>lb</strong> <span class="classifier-delimiter">:</span> <span class="classifier">array_like</span></dt>
<dd><p class="first last">Lower bounds for the model parameters. If not specified, it is left unbounded.</p>
</dd>
<dt><strong>ub</strong> <span class="classifier-delimiter">:</span> <span class="classifier">array_like</span></dt>
<dd><p class="first last">Upper bounds for the model parameters. If not specified, it is left unbounded.</p>
</dd>
<dt><strong>weights</strong> <span class="classifier-delimiter">:</span> <span class="classifier">array_like, optional</span></dt>
<dd><p class="first last">Array of weighting coefficients for the individual signals in global fitting, the default is all weighted equally.</p>
</dd>
<dt><strong>rescale</strong> <span class="classifier-delimiter">:</span> <span class="classifier">boolean, optional</span></dt>
<dd><p class="first last">Enable/disable optimization of the signal scale, by default it is enabled.</p>
</dd>
<dt><strong>multiStarts</strong> <span class="classifier-delimiter">:</span> <span class="classifier">scalar, optional</span></dt>
<dd><p class="first last">Number of starting points for global optimization, the default is 1.</p>
</dd>
<dt><strong>uqanalysis</strong> <span class="classifier-delimiter">:</span> <span class="classifier">boolean, optional</span></dt>
<dd><p class="first last">Enable/disable the uncertainty quantification analysis, by default it is enabled.</p>
</dd>
<dt><strong>tol</strong> <span class="classifier-delimiter">:</span> <span class="classifier">scalar, optional</span></dt>
<dd><p class="first last">Optimizer function tolerance, the default is 1e-10.</p>
</dd>
<dt><strong>maxeval</strong> <span class="classifier-delimiter">:</span> <span class="classifier">scalar, optional</span></dt>
<dd><p class="first last">Maximum number of optimizer iterations, the default is 5000.</p>
</dd>
<dt><strong>maxiter</strong> <span class="classifier-delimiter">:</span> <span class="classifier">scalar, optional</span></dt>
<dd><p class="first last">Maximum number of optimizer iterations, the default is 3000.</p>
</dd>
<dt><strong>covmatrix</strong> <span class="classifier-delimiter">:</span> <span class="classifier">array_like with shape(n,n), optional</span></dt>
<dd><p class="first last">Covariance matrix of the noise in the dataset(s). If not specified it is automatically computed.</p>
</dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><dl class="first last docutils">
<dt><a class="reference internal" href="FitResult.html#fitresult"><span class="std std-ref">FitResult</span></a> with the following fields defined:</dt>
<dd></dd>
<dt><strong>param</strong> <span class="classifier-delimiter">:</span> <span class="classifier">ndarray</span></dt>
<dd><p class="first last">Fitted model parameters</p>
</dd>
<dt><strong>uncertainty</strong> <span class="classifier-delimiter">:</span> <span class="classifier"><a class="reference internal" href="UncertQuant.html#uncertquant"><span class="std std-ref">UncertQuant</span></a></span></dt>
<dd><p class="first last">Covariance-based uncertainty quantification of the fitted parameters.</p>
</dd>
<dt><strong>scale</strong> <span class="classifier-delimiter">:</span> <span class="classifier">float int or list of float int</span></dt>
<dd><p class="first last">Amplitude scale(s) of the dipolar signal(s).</p>
</dd>
<dt><strong>plot</strong> <span class="classifier-delimiter">:</span> <span class="classifier">callable</span></dt>
<dd><p class="first last">Function to display the results. It will 
display the fitted signals. If requested, the function returns 
the <code class="docutils literal notranslate"><span class="pre">matplotlib.axes</span></code> object as output.</p>
</dd>
<dt><strong>stats</strong> <span class="classifier-delimiter">:</span> <span class="classifier">dict</span></dt>
<dd><p class="first">Goodness of fit statistical estimators:</p>
<ul class="last simple">
<li><code class="docutils literal notranslate"><span class="pre">stats['chi2red']</span></code> - Reduced chi^2 test</li>
<li><code class="docutils literal notranslate"><span class="pre">stats['r2']</span></code> - R^2 test</li>
<li><code class="docutils literal notranslate"><span class="pre">stats['rmsd']</span></code> - Root-mean squared deviation (RMSD)</li>
<li><code class="docutils literal notranslate"><span class="pre">stats['aic']</span></code> - Akaike information criterion</li>
<li><code class="docutils literal notranslate"><span class="pre">stats['aicc']</span></code> - Corrected Akaike information criterion</li>
<li><code class="docutils literal notranslate"><span class="pre">stats['bic']</span></code> - Bayesian information criterion</li>
</ul>
</dd>
<dt><strong>success</strong> <span class="classifier-delimiter">:</span> <span class="classifier">bool</span></dt>
<dd><p class="first last">Whether or not the optimizer exited successfully.</p>
</dd>
<dt><strong>cost</strong> <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd><p class="first last">Value of the cost function at the solution.</p>
</dd>
<dt><strong>residuals</strong> <span class="classifier-delimiter">:</span> <span class="classifier">ndarray</span></dt>
<dd><p class="first last">Vector of residuals at the solution.</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<p>A simple example for fitting a fully parametric 4-pulse DEER signal:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">K0</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">dipolarkernel</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">r</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">Vmodel</span><span class="p">(</span><span class="n">par</span><span class="p">):</span>
    <span class="c1"># Extract parameters</span>
    <span class="n">rmean</span><span class="p">,</span><span class="n">fwhm</span><span class="p">,</span><span class="n">lam</span><span class="p">,</span><span class="n">conc</span> <span class="o">=</span> <span class="n">par</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">bg_hom3d</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">conc</span><span class="p">)</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">dd_gauss</span><span class="p">(</span><span class="n">r</span><span class="p">,[</span><span class="n">rmean</span><span class="p">,</span><span class="n">fwhm</span><span class="p">])</span>
    <span class="n">V</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">lam</span> <span class="o">+</span> <span class="n">lam</span><span class="o">*</span><span class="n">K0</span><span class="nd">@P</span><span class="p">)</span><span class="o">*</span><span class="n">B</span>
    <span class="k">return</span> <span class="n">V</span>

<span class="c1"># par: rmean fwhm lam conc</span>
<span class="n">par0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">3.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mi">250</span><span class="p">]</span> <span class="c1"># start values</span>
<span class="n">lb</span>   <span class="o">=</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span>  <span class="mf">0.1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">50</span> <span class="p">]</span> <span class="c1"># lower bounds</span>
<span class="n">ub</span>   <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span>   <span class="mi">5</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span>  <span class="mi">800</span><span class="p">]</span> <span class="c1"># upper bounds</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">fitparamodel</span><span class="p">(</span><span class="n">V</span><span class="p">,</span><span class="n">Vmodel</span><span class="p">,</span><span class="n">par0</span><span class="p">,</span><span class="n">lb</span><span class="p">,</span><span class="n">ub</span><span class="p">)</span>
</pre></div>
</div>
<p>If multiple datasets are to be fitted globally, this can be easily achieved by adapting the example above. Differentiating between local and global parameters is also simple. This example shows the definition of a full parametric model of two signals with same underlying distance distribution and background but different modulation depths:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">K1</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">dipolarkernel</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="n">r</span><span class="p">)</span>
<span class="n">K1</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">dipolarkernel</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span><span class="n">r</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">Vmodel</span><span class="p">(</span><span class="n">par</span><span class="p">):</span>
    <span class="c1"># Extract parameters</span>
    <span class="n">rmean</span><span class="p">,</span><span class="n">fwhm</span><span class="p">,</span><span class="n">lam1</span><span class="p">,</span><span class="n">lam</span><span class="p">,</span><span class="mi">2</span><span class="n">conc</span> <span class="o">=</span> <span class="n">par</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">bg_hom3d</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">conc</span><span class="p">)</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">dd_gauss</span><span class="p">(</span><span class="n">r</span><span class="p">,[</span><span class="n">rmean</span><span class="p">,</span><span class="n">fwhm</span><span class="p">])</span>
    <span class="n">V1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">lam1</span> <span class="o">+</span> <span class="n">lam1</span><span class="o">*</span><span class="n">K1</span><span class="nd">@P</span><span class="p">)</span><span class="o">*</span><span class="n">B</span>
    <span class="n">V2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">lam2</span> <span class="o">+</span> <span class="n">lam2</span><span class="o">*</span><span class="n">K2</span><span class="nd">@P</span><span class="p">)</span><span class="o">*</span><span class="n">B</span>
    <span class="k">return</span> <span class="n">V</span>

<span class="c1"># par: rmean fwhm lam1 lam2 conc</span>
<span class="n">par0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">3.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mi">250</span><span class="p">]</span> <span class="c1"># start values</span>
<span class="n">lb</span>   <span class="o">=</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span>  <span class="mf">0.1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>  <span class="mi">50</span> <span class="p">]</span> <span class="c1"># lower bounds</span>
<span class="n">ub</span>   <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span>   <span class="mi">5</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span>  <span class="mi">800</span><span class="p">]</span> <span class="c1"># upper bounds</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">fitparamodel</span><span class="p">([</span><span class="n">V1</span><span class="p">,</span><span class="n">V2</span><span class="p">],</span><span class="n">Vmodel</span><span class="p">,</span><span class="n">par0</span><span class="p">,</span><span class="n">lb</span><span class="p">,</span><span class="n">ub</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="fitregmodel.html" class="btn btn-neutral float-right" title="fitregmodel" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="fitmultimodel.html" class="btn btn-neutral float-left" title="fitmultimodel" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019-2020, Luis Fábregas Ibáñez, Stefan Stoll, and others

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>

  
  
    
   

</body>
</html>