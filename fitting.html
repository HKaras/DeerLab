

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Fitting &mdash; DeerLab  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="/source/_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="/source/_static/theme_override.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="_static/table_util.css" type="text/css" />
  <link rel="stylesheet" href="_static/table_main.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_override.css" type="text/css" />
  <link rel="stylesheet" href="_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="_static/gallery-dataframe.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Uncertainty" href="uncertainty.html" />
    <link rel="prev" title="Loading and preprocessing" href="preprocess.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation instructions</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="firstscript.html">A first script</a></li>
<li class="toctree-l1"><a class="reference internal" href="basics.html">Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="preprocess.html">Loading and preprocessing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="uncertainty.html">Uncertainty</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="functions.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="modelsref.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="theory.html">Theory</a></li>
</ul>
<p class="caption"><span class="caption-text">Others</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="funding.html">Funding</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">DeerLab</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Fitting</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="fitting">
<h1>Fitting<a class="headerlink" href="#fitting" title="Permalink to this headline">¶</a></h1>
<p>DeerLab provides a wide range of functionality to analyze experimental dipolar EPR data using least-squares fitting. For fitting, the experimental data is assumed to be properly phased, shifted, and scaled.</p>
<p>The main fitting function is <code class="docutils literal notranslate"><span class="pre">fitsignal</span></code>. It can fit either non-parametric and parametric distance distributions, and it fits the distribution, the background, and the modulation depth in a single step. It provides uncertainty estimates for all fitted quantities.</p>
<p>The older two-step workflow of fitting the background in a separate step is supported as well, but not recommended.</p>
<div class="section" id="picking-the-model">
<h2>Picking the model<a class="headerlink" href="#picking-the-model" title="Permalink to this headline">¶</a></h2>
<p>After preprocessing the experimental data, the next important step is to decide on the model to be fitted. This consists of four separate choices</p>
<ol class="arabic simple">
<li><p>Choose a <strong>distance range</strong> <code class="docutils literal notranslate"><span class="pre">r</span></code>. The distance range is an important choice, as any distance distibution is truncated to this range. The lower limit of the distance range is determined by the bandwidth of the pulses, and also on the time increment. Typically, 1.5 nm is reasonable. The upper limit depends on the length of the experimental time trace. The number of points in <code class="docutils literal notranslate"><span class="pre">r</span></code> is usually set equal to the number of time points.</p></li>
<li><p>Choose a <strong>distribution model</strong>. Generally, a non-parametric distribution is preferred. If there a reasons to believe the distances distribution has a specific shape, use the associated <a class="reference internal" href="modelsref.html#modelsref-dd"><span class="std std-ref">parametric distance distibution model</span></a>.</p></li>
<li><p>Choose a <strong>background model</strong>. Typically, a homogeneous 3D background (<code class="docutils literal notranslate"><span class="pre">bg_hom3d</span></code>) is sufficient, but other <a class="reference internal" href="modelsref.html#modelsref-bg"><span class="std std-ref">background models</span></a> could be needed.</p></li>
<li><p>Select an <strong>experiment model</strong>. If analyzing a standard 4-pulse DEER trace without 2+1 component at the end, use <code class="docutils literal notranslate"><span class="pre">ex_4pdeer</span></code>. If the 2+1 components should be fitted as well, use <code class="docutils literal notranslate"><span class="pre">ex_ovl4pdeer</span></code>. There are <a class="reference internal" href="modelsref.html#modelsref-ex"><span class="std std-ref">experimental models</span></a> for more complicated signals.</p></li>
</ol>
</div>
<div class="section" id="non-parametric-distribution">
<h2>Non-parametric distribution<a class="headerlink" href="#non-parametric-distribution" title="Permalink to this headline">¶</a></h2>
<p>To fit a signal with a non-parametric distance distribution, the simplest possible call is</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fit</span> <span class="o">=</span> <span class="nf">fitsignal</span><span class="p">(</span><span class="n">Vexp</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">r</span><span class="p">)</span>
</pre></div>
</div>
<p>This fits the signal in <code class="docutils literal notranslate"><span class="pre">Vexp</span></code> (defined over the time axis <code class="docutils literal notranslate"><span class="pre">t</span></code>) with a non-parametric distance distribution defined over distance vector <code class="docutils literal notranslate"><span class="pre">r</span></code>, a homogeneous 3D spin distribution for the background, and a modulation depth (assuming a standard 4-pulse DEER).</p>
<p>To obtain the fitted signal, use</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fit</span> <span class="o">=</span> <span class="nf">fitsignal</span><span class="p">(</span><span class="n">Vexp</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">r</span><span class="p">)</span>
</pre></div>
</div>
<p>Since all fit functions in DeerLab are agnostic with respect to the absolute scale of the signal amplitude (does not need to statisfy <code class="docutils literal notranslate"><span class="pre">V(t=0)==1</span></code>), the pre-processed signals can be passed directly to the fit functions and the corresponding scale will be automatically fitted and returned as the output <code class="docutils literal notranslate"><span class="pre">fit.scale</span></code>.</p>
<p>With additional inputs, you can specify which <a class="reference internal" href="modelsref.html#modelsref-dd"><span class="std std-ref">distance distribution model</span></a>, <a class="reference internal" href="modelsref.html#modelsref-bg"><span class="std std-ref">background model</span></a>, and <a class="reference internal" href="modelsref.html#modelsref-ex"><span class="std std-ref">experiment model</span></a> to use for fitting:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fit</span> <span class="o">=</span> <span class="nf">fitsignal</span><span class="p">(</span><span class="n">Vexp</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="nf">bg_hom3d</span><span class="p">,</span><span class="nf">ex_4pdeer</span><span class="p">)</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">'P'</span></code> specifies that a non-parametric distribution (defined over <code class="docutils literal notranslate"><span class="pre">r</span></code>) should be fitted. <code class="docutils literal notranslate"><span class="pre">bg_hom3d</span></code> is a function handle to the background model function. If you want to fit a signal that doesn’t have a background, use  <code class="docutils literal notranslate"><span class="pre">None</span></code> instead.  <code class="docutils literal notranslate"><span class="pre">ex_4pdeer</span></code> is a function handle to the particular experiment model. <code class="docutils literal notranslate"><span class="pre">ex_4pdeer</span></code> consists of the main dipolar modulation function centered at time zero with an ampltitude <code class="docutils literal notranslate"><span class="pre">lambda</span></code> plus a constant offset of amplitude <code class="docutils literal notranslate"><span class="pre">1-lambda</span></code>. If you want to fit a simple dipolar evolution function with 100% modulation depth, use <code class="docutils literal notranslate"><span class="pre">None</span></code> as the experiment model.</p>
<p><code class="docutils literal notranslate"><span class="pre">fitsignal</span></code> uses a least-squares fitting algorithm to determine the optimal distribution, background parameters, and experiment parameters that fit the experiment data. To determine the non-parametric distribution, it internally uses Tikhnonov regularization with a regularization parameter optimized using the Akaike Information Criterion (AIC). These settings can be changed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">regtype</span> <span class="o">=</span> <span class="s1">&#39;tv&#39;</span>  <span class="c1"># use total variation instead of Tikhonov regularization</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span>     <span class="c1"># manually set regularization parameter</span>
<span class="n">fit</span> <span class="o">=</span> <span class="nf">fitsignal</span><span class="p">(</span><span class="n">Vexp</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="nf">bg_hom3d</span><span class="p">,</span><span class="nf">ex_4pdeer</span><span class="p">,</span><span class="n">regtype</span><span class="o">=</span><span class="n">regtype</span><span class="p">,</span><span class="n">regparam</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">fitsignal</span></code> returns a variable <code class="docutils literal notranslate"><span class="pre">fit</span></code> which contains all the required results from the fit: the fitted distance distribution, background and signal, all the fitted parameters as well as uncertainties for all of them. A full list of <code class="docutils literal notranslate"><span class="pre">fitsignal</span></code> outputs can be found <a class="reference external" href="./functions/fitsignal.html">here</a>.</p>
</div>
<div class="section" id="parametric-distributions">
<h2>Parametric distributions<a class="headerlink" href="#parametric-distributions" title="Permalink to this headline">¶</a></h2>
<p>To use a parametric distance distribution model, provide <code class="docutils literal notranslate"><span class="pre">fitsignal</span></code> with a function handle to the <a class="reference internal" href="modelsref.html#modelsref-dd"><span class="std std-ref">distance distribution models</span></a> instead of <code class="docutils literal notranslate"><span class="pre">'P'</span></code>. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fit</span> <span class="o">=</span> <span class="nf">fitsignal</span><span class="p">(</span><span class="n">Vexp</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="nf">dd_gauss2</span><span class="p">,</span><span class="nf">bg_hom3d</span><span class="p">,</span><span class="nf">ex_4pdeer</span><span class="p">)</span>
</pre></div>
</div>
<p>This will fit a two-Gauss distribution over <code class="docutils literal notranslate"><span class="pre">r</span></code>. The fitted distribution parameters are returned in <code class="docutils literal notranslate"><span class="pre">parfit</span></code>, and the corresponding distribution in <code class="docutils literal notranslate"><span class="pre">Pfit</span></code>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="uncertainty.html" class="btn btn-neutral float-right" title="Uncertainty" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="preprocess.html" class="btn btn-neutral float-left" title="Loading and preprocessing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019-2020, Luis Fábregas Ibáñez, Stefan Stoll, and others

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>

  
  
    
   

</body>
</html>