

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Getting Started &mdash; DeerLab  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="/source/_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="/source/_static/theme_override.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="_static/table_util.css" type="text/css" />
  <link rel="stylesheet" href="_static/table_main.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_override.css" type="text/css" />
  <link rel="stylesheet" href="_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="_static/gallery-dataframe.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Uncertainty" href="uncertainty.html" />
    <link rel="prev" title="Basics" href="basics.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                v0.13.0-dev
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="basics.html">Basics</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="uncertainty.html">Uncertainty</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="functions.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="modelsref.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="theory.html">Theory</a></li>
</ul>
<p class="caption"><span class="caption-text">Others</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="funding.html">Funding</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Release Notes</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">DeerLab</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Getting Started</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="getting-started">
<span id="beginners-guide"></span><h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<p>This is the introductory guide to DeerLab. If you have comments or suggestions, please don’t hesitate to reach out!</p>
<hr class="docutils" />
<div class="section" id="installing-deerlab">
<h2>Installing DeerLab<a class="headerlink" href="#installing-deerlab" title="Permalink to this headline">¶</a></h2>
<p>To install DeerLab, you need a valid Python installation on your computer. You can download it from the <a class="reference external" href="https://www.python.org/">official Python website</a> There are many useful and thorough tutorials out there to guide
you through the installation and setup (see <a class="reference external" href="https://realpython.com/installing-python/">here</a> for example). Make sure you install one of the compatible Python versions listed <a class="reference internal" href="installation.html#installation"><span class="std std-ref">here</span></a>.</p>
<p>If you have Python installed you can download and install DeerLab with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">deerlab</span>
</pre></div>
</div>
<p>If you want more detailed instructions for installing DeerLab on your operating system, you can <a class="reference internal" href="installation.html#installation"><span class="std std-ref">find all details here</span></a>.</p>
</div>
<hr class="docutils" />
<div class="section" id="importing-deerlab">
<h2>Importing DeerLab<a class="headerlink" href="#importing-deerlab" title="Permalink to this headline">¶</a></h2>
<p>Every time you want to use a package, library, or module in your code or script, you first need to make it accessible.
In order to start using all the functions available in DeerLab, you need to import it. This can be easily done with this import statement:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">deerlab</span> <span class="k">as</span> <span class="nn">dl</span>
</pre></div>
</div>
<p>We usually shorten DeerLab as <code class="docutils literal notranslate"><span class="pre">dl</span></code> in order to keep the code standardized so that everybody knows that these are DeerLab functions by
looking at your code, it also shortens the amount of text you need to type.</p>
<p>Other packages need to be imported as well, typically used in scientific work are</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>                <span class="c1"># NumPy: vectors, matrices, linear algebra</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>   <span class="c1"># MatPlotLib: plotting</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="getting-to-know-numpy">
<h2>Getting to know Numpy<a class="headerlink" href="#getting-to-know-numpy" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://numpy.org/doc/stable/index.html">NumPy</a> is the fundamental package for scientific computing in Python. It is a Python library
that provides a multidimensional array object, various derived objects (such as masked arrays and matrices), and an
assortment of routines for fast operations on arrays, including mathematical, logical, shape manipulation, sorting, selecting, I/O,
discrete Fourier transforms, basic linear algebra, basic statistical operations,
random simulation and much more.</p>
<p>Most mathematical operations in DeerLab are based on Numpy, and all numerical outputs returned by DeerLab functions are Numpy data types.
It is recommendable, to invest a short amount of time to familiarize yourself
with some <a class="reference external" href="https://numpy.org/doc/stable/user/basics.html">basic Numpy concepts</a>.</p>
<p>On the other hand, if you have previously worked with the MATLAB, here is a good guide of
<a class="reference external" href="https://numpy.org/doc/stable/user/numpy-for-matlab-users.html">Numpy for MATLAB users</a>.</p>
</div>
<div class="section" id="whats-the-difference-between-a-python-list-and-a-numpy-array">
<h2>What’s the difference between a Python list and a NumPy array?<a class="headerlink" href="#whats-the-difference-between-a-python-list-and-a-numpy-array" title="Permalink to this headline">¶</a></h2>
<p>In DeerLab, you will notice that many functions take lists, NumPy-arrays or both as inputs. While a Python list can contain different data
types within a single list, all of the elements in a NumPy array (a so called ndarray) should share the same data type. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="c1"># is a list-type</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span> <span class="c1"># is an ndarray-type</span>
</pre></div>
</div>
<p>and the elements on such variables can be accessed by their indices in the exact same way:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># print the first element of the list</span>
<span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="c1"># print the third element of the ndarray</span>
</pre></div>
</div>
<p>Note that Python is a 0-indexed language, meaning that the first element of any list, array,… is indexed with 0.</p>
</div>
<hr class="docutils" />
<div class="section" id="loading-spectrometer-files">
<h2>Loading Spectrometer Files<a class="headerlink" href="#loading-spectrometer-files" title="Permalink to this headline">¶</a></h2>
<p>Dipolar EPR spectroscopy experiments, saved at the spectrometers, come in a variety of spectrometer-specific formats.  DeerLab provides a
function <code class="docutils literal notranslate"><span class="pre">deerload</span></code> that can read most spectrometer formats, can read both 1D and 2D datasets, both real- or complex-valued. If you are familiar
with the Easyspin package, <code class="docutils literal notranslate"><span class="pre">deerload</span></code> is equivalent to the load function <code class="docutils literal notranslate"><span class="pre">eprload</span></code> of that package.</p>
<p>First, you need to locate the spectrometer files you want to load and where the script you are writing is. Let’s assume that your script is called <code class="docutils literal notranslate"><span class="pre">myscript.py</span></code>
and that you experiment data is called <code class="docutils literal notranslate"><span class="pre">DEERexperiment.DTA</span></code> and you directories look like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">home</span>
 <span class="o">|-----</span><span class="n">experiments</span>
 <span class="o">|</span>      <span class="o">|</span>
 <span class="o">|</span>      <span class="o">|---</span><span class="n">DEERexperiment</span><span class="o">.</span><span class="n">DSC</span>
 <span class="o">|</span>      <span class="o">+---</span><span class="n">DEERexperiment</span><span class="o">.</span><span class="n">DTA</span>
 <span class="o">|</span>
 <span class="o">+-----</span><span class="n">scripts</span>
        <span class="o">|</span>
        <span class="o">+---</span><span class="n">myscript</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>From the perspective of your script, you have two ways to reference the data files: using absolute or relative paths, in the example above:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">filepath</span> <span class="o">=</span> <span class="s1">&#39;/home/experiments/DEERexperiment.DTA&#39;</span>   <span class="c1"># absolute path</span>
<span class="n">filepath</span> <span class="o">=</span> <span class="s1">&#39;../../experiments/DEERexperiment.DTA&#39;</span>   <span class="c1"># relative path</span>
</pre></div>
</div>
<p>Then you just need to call <code class="docutils literal notranslate"><span class="pre">deerload</span></code> and specify the path of the file. If you look into the <a class="reference internal" href="functions/deerload.html#deerload"><span class="std std-ref">reference documentation</span></a>
for <code class="docutils literal notranslate"><span class="pre">deerload</span></code> you will see that the function returns two output variables: the first one <code class="docutils literal notranslate"><span class="pre">t</span></code> is the time-axis of your experiment, and the second one
<code class="docutils literal notranslate"><span class="pre">V</span></code> is the raw experimental data as exported by your spectrometer.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t</span><span class="p">,</span><span class="n">V</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">deerload</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>   <span class="c1"># load experimental data</span>
</pre></div>
</div>
<p>Both <code class="docutils literal notranslate"><span class="pre">t</span></code> and <code class="docutils literal notranslate"><span class="pre">V</span></code> will be returned as (at least) 1D-Numpy arrays with <code class="docutils literal notranslate"><span class="pre">N</span></code> elements. If you need or want to load more than one dataset, you
just need to specify the path of the other file and load them into different variables:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">filepath1</span> <span class="o">=</span> <span class="s1">&#39;/home/experiments/DEER4p_experiment.DTA&#39;</span>   <span class="c1"># absolute path to 1st file</span>
<span class="n">filepath2</span> <span class="o">=</span> <span class="s1">&#39;/home/experiments/DEER5p_experiment.DTA&#39;</span>   <span class="c1"># absolute path to 2nd file</span>
<span class="n">t1</span><span class="p">,</span><span class="n">V2</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">deerload</span><span class="p">(</span><span class="n">filepath1</span><span class="p">)</span>   <span class="c1"># load 1st set of experimental data</span>
<span class="n">t2</span><span class="p">,</span><span class="n">V2</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">deerload</span><span class="p">(</span><span class="n">filepath2</span><span class="p">)</span>   <span class="c1"># load 2nd set of experimental data</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal notranslate"><span class="pre">deerload</span></code> attempts to return the experiment time-axis <code class="docutils literal notranslate"><span class="pre">t</span></code> in the correct units (microseconds), but might not be able to do so for all file formats.</p>
</div>
<hr class="docutils" />
<div class="section" id="pre-processing">
<h2>Pre-Processing<a class="headerlink" href="#pre-processing" title="Permalink to this headline">¶</a></h2>
<p>Raw experimental dipolar EPR spectroscopy data comes in a crude state and must be undergo a series of pre-processing steps prior to any fitting.</p>
<dl class="docutils">
<dt>Phase correction</dt>
<dd><p class="first">Experimental dipolar signals are usually complex, the first step if to perform a phase correction which will minimize the imaginary component and maximize the real component.
If the signal is not complex-valued this step can be omitted. The phase correction function <code class="docutils literal notranslate"><span class="pre">correctphase</span></code> takes the complex-valued dipolar signal, and returns the real-valued
dipolar signal, whose real-part has been optimized:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">V</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">correctphase</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>  <span class="c1"># phase correction of experimental data</span>
</pre></div>
</div>
<p class="last">It is important to note that all other DeerLab functions do not behave properly or might lead to errors if the dipolar signal is
complex-valued.</p>
</dd>
<dt>Zero-time correction</dt>
<dd><p class="first">Depending on the file format and the spectrometer, the values of the experiment time-axis might be defined differently. Frequently, in commercial spectrometers these are defined
as absolute timings, with the zero-time corresponding to the first element <code class="docutils literal notranslate"><span class="pre">t[0]=0</span></code>. In dipolar EPR spectroscopy models, we define the zero-time as that time, where the dipolar
signal has its largest contribution or amplitude.
The function <code class="docutils literal notranslate"><span class="pre">correctzerotime</span></code> takes the time-axis <code class="docutils literal notranslate"><span class="pre">t</span></code> and dipolar signal <code class="docutils literal notranslate"><span class="pre">V</span></code> and optimizes the timing that corresponds to the signal’s maximum (taking into account noise in
the data). The function returns the time-axis with the correct zero-time:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">correctzerotime</span><span class="p">(</span><span class="n">V</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>  <span class="c1"># zero-time correction</span>
</pre></div>
</div>
<p class="last">Note that the zero-time can technically be fitted if included as a model parameter. However, this requires much more expertise with DeerLab and its theoretical principles.</p>
</dd>
</dl>
<p>In both cases, the corrections are based on optimization approaches. Should that fail for a specific case, the phase and zero-time needed for correction can also be manually specified.
See the documentation for <a class="reference internal" href="functions/correctphase.html#correctphase"><span class="std std-ref">correctphase</span></a> and <a class="reference internal" href="functions/correctzerotime.html#correctzerotime"><span class="std std-ref">correctzerotime</span></a>.</p>
<p>Note that all analysis functions in DeeLab assume the dipolar signals and their corresponding time-axes to be properly pre-processed.</p>
</div>
<hr class="docutils" />
<div class="section" id="fitting-dipolar-signals">
<h2>Fitting Dipolar Signals<a class="headerlink" href="#fitting-dipolar-signals" title="Permalink to this headline">¶</a></h2>
<p>DeerLab provides a wide range of functionality to analyze experimental dipolar EPR data using least-squares fitting. While there are multiple analysis functions of varying application,
generality and difficulty, the main fit function of DeerLab is <code class="docutils literal notranslate"><span class="pre">fitsignal</span></code>. This function can fit non-parametric and parametric distance distributions, and all model parameters
(e.g. modulation depth, background decay rate, spin concentration, etc.) in a one-step analysis. It also provides uncertainty estimates for all fitted quantities (see later).</p>
<div class="section" id="picking-the-right-model">
<h3>Picking the right model<a class="headerlink" href="#picking-the-right-model" title="Permalink to this headline">¶</a></h3>
<p>DeerLab provides a very flexible framework to model dipolar signals originating from many different dipolar EPR spectroscopy experiments. Choosing a model that properly describes your
is of paramount importance. In <code class="docutils literal notranslate"><span class="pre">fitsignal</span></code> the main structure of the model is already defined, and the decision is divided into four decisions that define the model:</p>
<blockquote>
<div><ul class="simple">
<li><strong>Distance range</strong>: Also called the distance-axis, is the range of distances where the distribution is defined.</li>
<li><strong>Distribution model</strong>: Describes the distance distributions in a parametric (e.g. a Gaussian distribution) or non-parametric way.</li>
<li><strong>Background model</strong>: Describes the dipolar background arising from the inter-molecular contributions during an experiment.</li>
<li><strong>Experiment model</strong>: Describes specific properties of a dipolar signal that are dependent on the experiment used to acquire the data.</li>
</ul>
</div></blockquote>
<p>Now you must decide for a model. As described above, there are four separate choices to take</p>
<ol class="arabic">
<li><p class="first"><strong>Choosing a distance range</strong></p>
<p>The distance range <img class="math" src="_images/math/64a08d5a2e690dcc4c4910ebd4496af5590eb560.svg" alt="[r_\mathrm{min},r_\mathrm{max}]"/> is an important choice, as any distance distribution is truncated to this range, i.e. <img class="math" src="_images/math/1bdab7916914bf5c61fb5fda95f36910c1e52bd9.svg" alt="P(r)=0"/> for
<img class="math" src="_images/math/86e008c9d4a4d8fffe02feaca84832f2b626402f.svg" alt="r&lt;r_\mathrm{min}"/> and <img class="math" src="_images/math/e7186337d5c2028663db8fe8f716a52f4c63bc78.svg" alt="r&gt;r_\mathrm{max}"/>. The lower limit of the distance range is determined by the bandwidth of the pulses, and also on the time increment.
Typically, 1.5 nm is a reasonable choice. The upper limit depends on the length of the experimental time trace and on the distances in your sample. The number of points
in <code class="docutils literal notranslate"><span class="pre">r</span></code> is usually set equal to the number of time points. Such a distance-axis is usually defined as <code class="docutils literal notranslate"><span class="pre">r</span></code> is most easily defined using the <code class="docutils literal notranslate"><span class="pre">linspace</span></code> function from NumPy:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="nf">linspace</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>  <span class="c1"># define distance range form 1.5nm to 6nm with the same amount of points as t</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Choosing a distribution model</strong></p>
<p>Generally, a non-parametric distribution is preferred (specified using the string <code class="docutils literal notranslate"><span class="pre">'P'</span></code> in <code class="docutils literal notranslate"><span class="pre">fitsignal</span></code>), i.e. a distribution where each element <img class="math" src="_images/math/e9262823e350c817f49adb1e17e82a1a41f432b3.svg" alt="P_i"/> of the distribution is a parameter.
Non-parametric distributions are obtained via methods such as Tikhonov regularization. If there are reasons to believe that the distance distribution has a
specific shape (e.g. Gaussian, Rice, random-coil, etc.), use the associated parametric distance distribution model from the <a class="reference internal" href="modelsref.html#modelsref-dd"><span class="std std-ref">list of available models</span></a>.</p>
</li>
<li><p class="first"><strong>Choosing a background model</strong></p>
<p>Typically, a background arising from a homogenous 3D-distribution of spins is sufficient. The associated parametric model function is <a class="reference internal" href="models/bg_hom3d.html#bg-hom3d"><span class="std std-ref">bg_hom3d</span></a>. In some cases, depending on
the properties of your sample, other background models might be needed could be needed, such as background arising from distributions of spins in fractal dimensions or when
accounting for volume-exclusion effects. In such cases, use the associated parametric background models from the <a class="reference internal" href="modelsref.html#modelsref-bg"><span class="std std-ref">list of available models</span></a>.</p>
</li>
<li><p class="first"><strong>Choosing an experiment model</strong></p>
<p>This decision should be based on the experiment you used to acquire the data. In the case of 4-pulse DEER data, when analyzing a standard 4-pulse DEER signal without 2+1 component
at the end, use <a class="reference internal" href="models/ex_4pdeer.html#ex-4pdeer"><span class="std std-ref">ex_4pdeer</span></a>. If the 2+1 components should be fitted as well, use the <a class="reference internal" href="models/ex_ovl4pdeer.html#ex-ovl4pdeer"><span class="std std-ref">ex_ovl4pdeer</span></a> model. There are :experiment models for more complicated signals, such
as 5-pulse DEER or 7-pulse DEER. Use the associated parametric experiment models from the <a class="reference internal" href="modelsref.html#modelsref-ex"><span class="std std-ref">list of available models</span></a>.</p>
</li>
</ol>
<p>When your model does not have one of the these components, i.e. no background, no foreground, etc. the corresponding submodels can be set to <code class="docutils literal notranslate"><span class="pre">None</span></code> to specify the choice.</p>
<p>Here is a list of examples with different situations and what the proper choices of model are:</p>
<table border="1" class="docutils">
<colgroup>
<col width="57%" />
<col width="15%" />
<col width="14%" />
<col width="14%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Description</th>
<th class="head">Distribution model</th>
<th class="head">Background model</th>
<th class="head">Experiment model</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>4pDEER signal with homogenous 3D background and non-parametric distribution</td>
<td><code class="docutils literal notranslate"><span class="pre">'P'</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">bg_hom3d</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">ex_4pdeer</span></code></td>
</tr>
<tr class="row-odd"><td>4pDEER signal with homogenous 3D background and Gaussian distribution</td>
<td><code class="docutils literal notranslate"><span class="pre">dd_gauss</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">bg_hom3d</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">ex_4pdeer</span></code></td>
</tr>
<tr class="row-even"><td>Dipolar evolution function with a random-coil distribution</td>
<td><code class="docutils literal notranslate"><span class="pre">dd_randcoil</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">None</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">None</span></code></td>
</tr>
<tr class="row-odd"><td>4pDEER signal with no background and non-parametric distribution</td>
<td><code class="docutils literal notranslate"><span class="pre">'P'</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">None</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">ex_4pdeer</span></code></td>
</tr>
<tr class="row-even"><td>5pDEER signal with fractal background and non-parametric distribution</td>
<td><code class="docutils literal notranslate"><span class="pre">'P'</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">bg_homfractal</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">ex_5pdeer</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="starting-the-fit">
<h3>Starting the fit<a class="headerlink" href="#starting-the-fit" title="Permalink to this headline">¶</a></h3>
<p>Once you have chosen your model, you need to specify it to <code class="docutils literal notranslate"><span class="pre">fitsignal</span></code>. The function takes several inputs: the experimental dipolar signal <code class="docutils literal notranslate"><span class="pre">V</span></code> and its time=axis <code class="docutils literal notranslate"><span class="pre">t</span></code>, followed by all four
model components described above, distance-axis <code class="docutils literal notranslate"><span class="pre">r</span></code> the distribution, background and experiment models.</p>
<p>The models that have an associated parametric function, e.g. <code class="docutils literal notranslate"><span class="pre">bg_hom3d</span></code>, must be passed directly as inputs to <code class="docutils literal notranslate"><span class="pre">fitsignal</span></code>. In Python functions are treated as common numerical variables in that
they can be passed as inputs to other functions.</p>
<p>For example, a 4pDEER signal with homogenous 3D background and Tikhonov regularization can be fitted via</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fit</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">fitsignal</span><span class="p">(</span><span class="n">V</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="n">dl</span><span class="o">.</span><span class="nf">bg_hom3d</span><span class="p">,</span><span class="n">dl</span><span class="o">.</span><span class="nf">ex_4pdeer</span><span class="p">)</span>  <span class="c1"># 4pDEER fit</span>
</pre></div>
</div>
<p>For the other examples in the table above, the call to <code class="docutils literal notranslate"><span class="pre">fitsignal</span></code> would look like this</p>
<table border="1" class="docutils">
<colgroup>
<col width="54%" />
<col width="46%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Description</th>
<th class="head">Fit</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>4pDEER signal with homogenous 3D background and non-parametric distribution</td>
<td><code class="docutils literal notranslate"><span class="pre">fit</span> <span class="pre">=</span> <span class="pre">dl.fitsignal(V,t,r,'P',dl.bg_hom3d,dl.ex_4pdeer)</span></code></td>
</tr>
<tr class="row-odd"><td>4pDEER signal with homogenous 3D background and Gaussian distribution</td>
<td><code class="docutils literal notranslate"><span class="pre">fit</span> <span class="pre">=</span> <span class="pre">dl.fitsignal(V,t,r,dl.gauss,dl.bg_hom3d,dl.ex_4pdeer)</span></code></td>
</tr>
<tr class="row-even"><td>Dipolar evolution function with a random-coil distribution</td>
<td><code class="docutils literal notranslate"><span class="pre">fit</span> <span class="pre">=</span> <span class="pre">dl.fitsignal(V,t,r,dl.randcoil,None,None)</span></code></td>
</tr>
<tr class="row-odd"><td>4pDEER signal with no background and non-parametric distribution</td>
<td><code class="docutils literal notranslate"><span class="pre">fit</span> <span class="pre">=</span> <span class="pre">dl.fitsignal(V,t,r,'P',None,dl.ex_4pdeer)</span></code></td>
</tr>
<tr class="row-even"><td>5pDEER signal with fractal background and non-parametric distribution</td>
<td><code class="docutils literal notranslate"><span class="pre">fit</span> <span class="pre">=</span> <span class="pre">dl.fitsignal(V,t,r,'P',dl.bg_homfractal,dl.ex_5pdeer)</span></code></td>
</tr>
</tbody>
</table>
<p>fitsignal uses a least-squares fitting algorithm to determine the optimal distance distribution, background parameters, and experiment parameters that fit the experiment data. To determine the non-parametric
distribution, it internally uses Tikhnonov regularization with a regularization parameter optimized using the Akaike Information Criterion (AIC). All settings related to the fit can be adjusted by using the
appropriate keywords, see the <a class="reference internal" href="functions/fitsignal.html#fitsignal"><span class="std std-ref">reference documentation</span></a> for details. For example, the regularization parameter used in the Tikhonov regularization could be manually adjusted by using the <code class="docutils literal notranslate"><span class="pre">regparam</span></code>
keyword:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fit1</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">fitsignal</span><span class="p">(</span><span class="n">V</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="n">dl</span><span class="o">.</span><span class="nf">bg_hom3d</span><span class="p">,</span><span class="n">dl</span><span class="o">.</span><span class="nf">ex_4pdeer</span><span class="p">,</span> <span class="n">regparam</span><span class="o">=</span><span class="s1">&#39;aic&#39;</span><span class="p">)</span> <span class="c1"># regularization with Akaike information criterion</span>
<span class="n">fit2</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">fitsignal</span><span class="p">(</span><span class="n">V</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="n">dl</span><span class="o">.</span><span class="nf">bg_hom3d</span><span class="p">,</span><span class="n">dl</span><span class="o">.</span><span class="nf">ex_4pdeer</span><span class="p">,</span> <span class="n">regparam</span><span class="o">=</span><span class="s1">&#39;gcv&#39;</span><span class="p">)</span> <span class="c1"># regularization with Generalized Cross-Validation</span>
<span class="n">fit3</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">fitsignal</span><span class="p">(</span><span class="n">V</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="n">dl</span><span class="o">.</span><span class="nf">bg_hom3d</span><span class="p">,</span><span class="n">dl</span><span class="o">.</span><span class="nf">ex_4pdeer</span><span class="p">,</span> <span class="n">regparam</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>  <span class="c1"># regularization with fixed regularization parameter</span>
</pre></div>
</div>
<p>After the function has found a solution if will return a variable <code class="docutils literal notranslate"><span class="pre">fit</span></code>. This fit is an object with different fields containing all quantities of interest with the fit results.
A detailed list of these quantities can be found again in the <span class="xref std std-ref">reference</span> for <code class="docutils literal notranslate"><span class="pre">fitsignal</span></code>.</p>
</div>
<div class="section" id="displaying-the-results">
<h3>Displaying the results<a class="headerlink" href="#displaying-the-results" title="Permalink to this headline">¶</a></h3>
<p>For just a quick display of the results, you can use the <code class="docutils literal notranslate"><span class="pre">plot()</span></code> method of the <code class="docutils literal notranslate"><span class="pre">fit</span></code> object that will display a figure with you experimental data, the corresponding fit, and the fit of the distance distribution
including confidence bands.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fit</span><span class="o">.</span><span class="nf">plot</span><span class="p">()</span> <span class="c1"># display results</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/beginners_guide1.png"><img alt="_images/beginners_guide1.png" src="_images/beginners_guide1.png" style="width: 450px;" /></a>
<p>It is important to note that these confidence bands are covariance-based and might represent an overestimation of the true uncertainty on the results (see <span class="xref std std-ref">uncertainty</span> for further details). These bands indicate
regions in which the true values might be contained with a certain probability. It is important to always report fitted distance distributions with confidence bands.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">fit</span></code> output contains some interesting information as well, for example:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">fit.V</span></code>, <code class="docutils literal notranslate"><span class="pre">fit.B</span></code>, and <code class="docutils literal notranslate"><span class="pre">fit.P</span></code> contain the arrays of the fitted dipolar signal, background and distance distribution, respectively.</li>
<li><code class="docutils literal notranslate"><span class="pre">fit.exparam</span></code>, <code class="docutils literal notranslate"><span class="pre">fit.bgparam</span></code>, and <code class="docutils literal notranslate"><span class="pre">fit.ddparam</span></code> contain the arrays of fitted model parameters for each of the experiment, background and distribution models.</li>
<li><code class="docutils literal notranslate"><span class="pre">fit.scale</span></code> contains the fitted arbitrary scale of the dipolar signal.</li>
</ul>
</div></blockquote>
<p>In addition to the distance distribution fit, it is important to check and report the fitted model parameters and their uncertainties. While this can be computed manually, a summary can be easily requested by enabling the
<code class="docutils literal notranslate"><span class="pre">verbose</span></code> option of <code class="docutils literal notranslate"><span class="pre">fitsignal</span></code>. By using</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fit</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">fitsignal</span><span class="p">(</span><span class="n">V</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="n">dl</span><span class="o">.</span><span class="nf">bg_hom3d</span><span class="p">,</span><span class="n">dl</span><span class="o">.</span><span class="nf">ex_4pdeer</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># 4pDEER fit and report parameter fits</span>
</pre></div>
</div>
<p>after the function has fitted your data, it will print a summary the results, including goodness-of-fit estimators
and fitted parameters with uncertainties, for example</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>-----------------------------------------------------------------------------------
Goodness of fit
Vexp[0]: chi2 = 1.008066  RMSD  = 0.019209
-----------------------------------------------------------------------------------
Fitted parameters and 95%-confidence intervals
Vfit[0]:
bgparam[0]:   292.02402  (230.33576, 353.71227)  Concentration of pumped spins (μM)
exparam[0]:   0.5097663  (0.4809968, 0.5385358)  Modulation depth ()
-----------------------------------------------------------------------------------
</pre></div>
</div>
<p>where there are no distribution parameters <code class="docutils literal notranslate"><span class="pre">ddparam</span></code> due to the distribution model being non-parametric.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Summarizing, this would be an example script to load experimental data, pre-process the signal, and fit a 4-pulse DEER model with a non-parametric distance distribution:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">deerlab</span> <span class="k">as</span> <span class="nn">dl</span>

<span class="c1"># Data import</span>
<span class="n">filepath</span> <span class="o">=</span> <span class="s1">&#39;/home/experiments/DEERexperiment.DTA&#39;</span>  <span class="c1"># file path</span>
<span class="n">t</span><span class="p">,</span><span class="n">V</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">deerload</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>   <span class="c1"># load experimental data</span>

<span class="c1"># Pre-processing</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">correctphase</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>   <span class="c1"># phase correction of experimental data</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">correctzerotime</span><span class="p">(</span><span class="n">V</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>   <span class="c1"># zero-time correction</span>

<span class="c1"># Distance range</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="nf">linspace</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>   <span class="c1"># define distance range form 1.5nm to 6nm with the same amount of points as t</span>

<span class="c1"># Fit</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">fitsignal</span><span class="p">(</span><span class="n">V</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="n">dl</span><span class="o">.</span><span class="nf">bg_hom3d</span><span class="p">,</span><span class="n">dl</span><span class="o">.</span><span class="nf">ex_4pdeer</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>   <span class="c1"># 4pDEER fit</span>
<span class="n">fit</span><span class="o">.</span><span class="nf">plot</span><span class="p">()</span> <span class="c1"># display results</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="uncertainty.html" class="btn btn-neutral float-right" title="Uncertainty" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="basics.html" class="btn btn-neutral float-left" title="Basics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019-2020, Luis Fábregas Ibáñez, Stefan Stoll, and others

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>

  
  
    
   

</body>
</html>