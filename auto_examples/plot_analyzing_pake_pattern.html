

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Analyzing the Pake pattern of a dipolar signal &mdash; DeerLab  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="/source/_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="/source/_static/theme_override.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/table_util.css" type="text/css" />
  <link rel="stylesheet" href="../_static/table_main.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_override.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-dataframe.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Comparing confidence intervals for regularization results" href="plot_comparing_uncertainties_for_regularization.html" />
    <link rel="prev" title="Fitting a mixed distance-distribution model" href="plot_fitting_mixed_model.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                v0.11.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation instructions</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../firstscript.html">A first script</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics.html">Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preprocess.html">Loading and preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fitting.html">Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uncertainty.html">Uncertainty</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../functions.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modelsref.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../theory.html">Theory</a></li>
</ul>
<p class="caption"><span class="caption-text">Others</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../funding.html">Funding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DeerLab</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../examples.html">Examples</a> &raquo;</li>
        
      <li>Analyzing the Pake pattern of a dipolar signal</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-examples-plot-analyzing-pake-pattern-py"><span class="std std-ref">here</span></a>     to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="analyzing-the-pake-pattern-of-a-dipolar-signal">
<span id="sphx-glr-auto-examples-plot-analyzing-pake-pattern-py"></span><h1>Analyzing the Pake pattern of a dipolar signal<a class="headerlink" href="#analyzing-the-pake-pattern-of-a-dipolar-signal" title="Permalink to this headline">¶</a></h1>
<p>A very basic example for displaying the dipolar spectrum (Pake pattern) of a given dipolar signal.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">deerlab</span> <span class="k">as</span> <span class="nn">dl</span>
</pre></div>
</div>
<div class="section" id="generate-a-dipolar-signal">
<h2>Generate a dipolar signal<a class="headerlink" href="#generate-a-dipolar-signal" title="Permalink to this headline">¶</a></h2>
<p>Let’s start by simulating a dipolar signal with some background and noise.</p>
<p>Prepare components</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="nf">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">400</span><span class="p">)</span>   <span class="c1"># µs</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="nf">linspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>   <span class="c1"># nm</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">dd_gauss2</span><span class="p">(</span><span class="n">r</span><span class="p">,[</span><span class="mf">3.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">bg_exp</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">lam</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">K</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">dipolarkernel</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">lam</span><span class="p">,</span><span class="n">B</span><span class="p">)</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">K</span><span class="nd">@P</span> <span class="o">+</span> <span class="n">dl</span><span class="o">.</span><span class="nf">whitegaussnoise</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="mf">0.005</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Plot</span>
<span class="n">plt</span><span class="o">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="s1">&#39;k.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="nf">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="nf">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [$</span><span class="se">\\</span><span class="s1">mu s$]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="s1">&#39;V(t)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="plot analyzing pake pattern" class="sphx-glr-single-img" src="../_images/sphx_glr_plot_analyzing_pake_pattern_001.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Text(9.444444444444452, 0.5, &#39;V(t)&#39;)
</pre></div>
</div>
</div>
<div class="section" id="prepare-the-signal">
<h2>Prepare the signal<a class="headerlink" href="#prepare-the-signal" title="Permalink to this headline">¶</a></h2>
<p>Since experimental dipolar signals contain the background, this must be fitted
removed prior to Fourier transform.</p>
<p>First we proceed to fit the background function using some time-domain parametric
model. In this example we will use an exponential function (<code class="docutils literal notranslate"><span class="pre">bg_exp</span></code>).
Using the <code class="docutils literal notranslate"><span class="pre">fitparamodel</span></code> function we obtain the fitted background as well as
the fitted modulation depth.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tstart</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># Time to start fitting background, in µs</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">t</span><span class="o">&gt;</span><span class="n">tstart</span>
<span class="c1"># Model for the background component (1-lambda)*B</span>
<span class="k">def</span> <span class="nf">Bmodel</span><span class="p">(</span><span class="n">par</span><span class="p">):</span>
    <span class="n">lam</span><span class="p">,</span><span class="n">kappa</span> <span class="o">=</span> <span class="n">par</span>
    <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">lam</span><span class="p">)</span><span class="o">*</span><span class="n">dl</span><span class="o">.</span><span class="nf">bg_exp</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span><span class="n">kappa</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">B</span>

<span class="c1"># Fit the background function</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">fitsignal</span><span class="p">(</span><span class="n">V</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="n">dl</span><span class="o">.</span><span class="nf">bg_exp</span><span class="p">,</span><span class="n">dl</span><span class="o">.</span><span class="nf">ex_4pdeer</span><span class="p">,</span><span class="n">uqanalysis</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Bfit</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">B</span>
<span class="n">lam</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">exparam</span>
<span class="n">kappa</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">bgparam</span>
</pre></div>
</div>
<p>Now we can use these fitted parameters to isolate the dipolar evolution function
from the primary data. Removal of the background via division leads to a noise
increase at later times and thus to an approximation <code class="docutils literal notranslate"><span class="pre">Vcorr</span></code> of the real dipolar
evolution function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &quot;Correct&quot; for the background and modulation depth</span>
<span class="n">Vcorr</span> <span class="o">=</span> <span class="p">(</span><span class="n">V</span><span class="o">/</span><span class="n">Bfit</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">lam</span><span class="p">))</span><span class="o">/</span><span class="n">lam</span>

<span class="n">plt</span><span class="o">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">Vcorr</span><span class="p">,</span><span class="s1">&#39;k.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="nf">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="nf">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="s1">&#39;Time [$</span><span class="se">\\</span><span class="s1">mu s$]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="s1">&#39;V(t)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="plot analyzing pake pattern" class="sphx-glr-single-img" src="../_images/sphx_glr_plot_analyzing_pake_pattern_002.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Text(9.444444444444452, 0.5, &#39;V(t)&#39;)
</pre></div>
</div>
</div>
<div class="section" id="computing-the-dipolar-spectrum">
<h2>Computing the dipolar spectrum<a class="headerlink" href="#computing-the-dipolar-spectrum" title="Permalink to this headline">¶</a></h2>
<p>Now that the signal has the appropiate structure for Fourier transform it,
we can call the <code class="docutils literal notranslate"><span class="pre">fftspec</span></code> function to obtain the dipolar spectrum.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute spectrum</span>
<span class="n">nu</span><span class="p">,</span><span class="n">pake</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">fftspec</span><span class="p">(</span><span class="n">Vcorr</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">apodization</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

 <span class="c1"># %% [markdown]</span>
<span class="c1"># In order to avoid truncation ripples in the Fourier spectrum and at the same</span>
<span class="c1"># time to compensate for the increase of noise, we recommend the use of apodization</span>
<span class="c1"># using the appropiate option in ``fftspec``.</span>
</pre></div>
</div>
<p>Compute spectrum with apodization</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nuapo</span><span class="p">,</span><span class="n">pakeapo</span> <span class="o">=</span> <span class="n">dl</span><span class="o">.</span><span class="nf">fftspec</span><span class="p">(</span><span class="n">Vcorr</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">apodization</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;real&#39;</span><span class="p">)</span>

<span class="c1"># Plot results</span>
<span class="n">plt</span><span class="o">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span><span class="n">pake</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">nuapo</span><span class="p">,</span><span class="n">pakeapo</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="nf">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="nf">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="nf">xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency [MHz]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="s1">&#39;Intensity [a.u.]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="nf">legend</span><span class="p">([</span><span class="s1">&#39;Raw&#39;</span><span class="p">,</span><span class="s1">&#39;Apodized&#39;</span><span class="p">])</span>
</pre></div>
</div>
<img alt="plot analyzing pake pattern" class="sphx-glr-single-img" src="../_images/sphx_glr_plot_analyzing_pake_pattern_003.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend object at 0x7f5974e114d0&gt;
</pre></div>
</div>
<p>We do not need to worry about the zero-filling since <code class="docutils literal notranslate"><span class="pre">fftspec</span></code> takes care
of setting it to twice the amount of points in the signal, to preserve all information.
Adding more points will artificially increase the resolution of the Pake pattern.
The improvement will only be visual as no further information can be gained
from additional zero-filling.</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  2.924 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-plot-analyzing-pake-pattern-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/990802fc88d753641dbbef85b9eb8cb9/plot_analyzing_pake_pattern.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_analyzing_pake_pattern.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/e591bdbff05e58ece48f99876f046fe8/plot_analyzing_pake_pattern.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_analyzing_pake_pattern.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="plot_comparing_uncertainties_for_regularization.html" class="btn btn-neutral float-right" title="Comparing confidence intervals for regularization results" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="plot_fitting_mixed_model.html" class="btn btn-neutral float-left" title="Fitting a mixed distance-distribution model" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019-2020, Luis Fábregas Ibáñez, Stefan Stoll, and others

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>

  
  
    
   

</body>
</html>